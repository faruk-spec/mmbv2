<?php
/**
 * ImgTxt Admin - Overview Dashboard
 * Displays OCR statistics, recent jobs, and activity trends
 */
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImgTxt Admin - Overview</title>
    <style>
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
        }
        .stat-card h3 {
            font-size: 14px;
            margin: 0 0 10px 0;
            opacity: 0.9;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }
        .stat-card .trend {
            font-size: 12px;
            margin-top: 10px;
            opacity: 0.8;
        }
        .content-section {
            background: #1a1a2e;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .content-section h2 {
            color: #00ff88;
            margin-top: 0;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table th {
            background: #0f0f1e;
            padding: 12px;
            text-align: left;
            color: #00ff88;
            font-weight: 600;
        }
        table td {
            padding: 12px;
            border-bottom: 1px solid #2a2a3e;
            color: #e0e0e0;
        }
        table tr:hover {
            background: #0f0f1e;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-completed {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        .status-failed {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-content">
        <h1>ImgTxt Overview</h1>
        
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total OCR Jobs</h3>
                <p class="value"><?= number_format($stats['total_jobs'] ?? 0) ?></p>
                <p class="trend">↑ <?= $stats['jobs_trend'] ?? '+0' ?>% this week</p>
            </div>
            <div class="stat-card">
                <h3>Success Rate</h3>
                <p class="value"><?= $stats['success_rate'] ?? '0' ?>%</p>
                <p class="trend"><?= ($stats['success_rate'] ?? 0) >= 90 ? '✓ Excellent' : '⚠ Needs attention' ?></p>
            </div>
            <div class="stat-card">
                <h3>Pending Jobs</h3>
                <p class="value"><?= number_format($stats['pending_jobs'] ?? 0) ?></p>
                <p class="trend">In queue</p>
            </div>
            <div class="stat-card">
                <h3>Failed Jobs</h3>
                <p class="value"><?= number_format($stats['failed_jobs'] ?? 0) ?></p>
                <p class="trend"><?= $stats['failure_rate'] ?? '0' ?>% failure rate</p>
            </div>
        </div>

        <!-- Recent Jobs -->
        <div class="content-section">
            <h2>Recent OCR Jobs</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Filename</th>
                            <th>Language</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Processing Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php if (!empty($recent_jobs)): ?>
                            <?php foreach ($recent_jobs as $job): ?>
                                <tr>
                                    <td>#<?= $job['id'] ?></td>
                                    <td><?= htmlspecialchars($job['filename']) ?></td>
                                    <td><?= strtoupper($job['language']) ?></td>
                                    <td>
                                        <span class="status-badge status-<?= $job['status'] ?>">
                                            <?= ucfirst($job['status']) ?>
                                        </span>
                                    </td>
                                    <td><?= date('M d, Y H:i', strtotime($job['created_at'])) ?></td>
                                    <td><?= $job['processing_time'] ?? 'N/A' ?></td>
                                </tr>
                            <?php endforeach; ?>
                        <?php else: ?>
                            <tr>
                                <td colspan="6" style="text-align: center;">No jobs found</td>
                            </tr>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Language Usage -->
        <div class="content-section">
            <h2>Language Usage Statistics</h2>
            <div class="chart-container">
                <canvas id="languageChart"></canvas>
            </div>
        </div>

        <!-- Activity Trend -->
        <div class="content-section">
            <h2>7-Day Activity Trend</h2>
            <div class="chart-container">
                <canvas id="activityChart"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Language usage chart
        const langCtx = document.getElementById('languageChart').getContext('2d');
        new Chart(langCtx, {
            type: 'doughnut',
            data: {
                labels: <?= json_encode(array_keys($language_stats ?? ['eng' => 100])) ?>,
                datasets: [{
                    data: <?= json_encode(array_values($language_stats ?? [100])) ?>,
                    backgroundColor: [
                        '#00ff88', '#667eea', '#f5576c', '#ffc107', 
                        '#00bcd4', '#9c27b0', '#ff5722', '#795548'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#e0e0e0'
                        }
                    }
                }
            }
        });

        // Activity trend chart
        const actCtx = document.getElementById('activityChart').getContext('2d');
        new Chart(actCtx, {
            type: 'line',
            data: {
                labels: <?= json_encode($trend_labels ?? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']) ?>,
                datasets: [{
                    label: 'OCR Jobs',
                    data: <?= json_encode($trend_data ?? [0, 0, 0, 0, 0, 0, 0]) ?>,
                    borderColor: '#f5576c',
                    backgroundColor: 'rgba(245, 87, 108, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e0e0'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#e0e0e0' },
                        grid: { color: '#2a2a3e' }
                    },
                    x: {
                        ticks: { color: '#e0e0e0' },
                        grid: { color: '#2a2a3e' }
                    }
                }
            }
        });
    </script>
</body>
</html>
